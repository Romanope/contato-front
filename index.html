<!DOCTYPE html>
<html ng-app="listaTelefonica">
<head>
	<title>Lista Telefônica</title>
	<script type="text/javascript" src="js/angular.js"></script>
	<script type="text/javascript" src="js/angular-locale_pt-br.js"></script>
	 <meta charset="UTF-8"> 
	 <meta http-equiv="Content-Security-Policy"
        content="default-src *;
               script-src 'self' 'unsafe-inline' 'unsafe-eval'
                           127.0.0.1:*
                           http://*.gstatic.com          
                           http://*.googleapis.com
                           https://*.gstatic.com
                           https://*.googleapis.com
                           ;
               style-src  'self' 'unsafe-inline'
                           127.0.0.1
                           http://*.gstatic.com         
                           http://*.googleapis.com
                           https://*.gstatic.com
                           https://*.googleapis.com
    ">
	<script type="text/javascript">
		angular.module("listaTelefonica", []);
		angular.module("listaTelefonica").controller("listaTelefonicaCtrl", function ($scope, $http) {

			$scope.app = "Lista Telefônica";
			$scope.contatos = [];
			/*$scope.contatos = [
				{nome: "Ana Maria", dtCadastro: new Date(), fone: "(91) 9900-9900", cor: "red"},
				{nome: "Zeca Renato", dtCadastro: new Date(), fone: "(91) 9900-9900", cor: "blue"},
				{nome: "Carlos Jose", dtCadastro: new Date(), fone: "(91) 9900-9900", cor: "green"}
			];*/
			$scope.adicionarContato = function (contato) {
				$scope.contatos.push(contato);
				contato.dtCadastro = new Date();
				delete $scope.contato;
				$scope.contatoForm.$setPristine();
			};
			var carregarContatos = function() {
				$http.get("http://localhost:8080/contato/contato").then(function successCallback(response, status) {
					$scope.contatos = response.data;
				}, function errorCallback(response) {
					console.log(response);
				});
			};
			carregarContatos();
			$scope.operadoras = [
				{nome: "CLARO", codigo: 21, categoria: "Celular", preco: 2},
				{nome: "TIM", codigo: 41, categoria: "Celular", preco: 1},
				{nome: "VIVO", codigo: 50, categoria: "Celular", preco: 1.5},
				{nome: "GVT", codigo: 25, categoria: "Fixo", preco: 3},
				{nome: "Embratel", codigo: 30, categoria: "Fixo", preco: 4}
			];
			$scope.classe = "selecionado";
			$scope.apagarContatos = function (contatos) {
				$scope.contatos = contatos.filter(function (contato) {
					if (!contato.selecionado) {
						return contato;
					}
				});
			};
			$scope.isContatoSelecionado = function (contatos) {
				return contatos.some(function (contato) {
					return contato.selecionado;
				});
			};
			$scope.ordenarPor = function (campo) {
				$scope.order = campo;
				$scope.direcao = !$scope.direcao;
			};
		});
		
	</script>
	<link rel="stylesheet" type="text/css" href="css/bootstrap-3.3.7-dist/css/bootstrap.css">
	<style type="text/css">
		.jumbotron {
			width: 500px;
			text-align: center;
			margin-left: auto;
			margin-right: auto;
			margin-top: 20px;
		}
		.selecionado {
			background-color: yellow;
		}
	</style>
</head>
	<body ng-controller="listaTelefonicaCtrl">
		<div class="jumbotron">
			<h4 ng-bind="app"></h4>
			<input name="busca" ng-model="busca" class="form-control" placeholder="O que esta buscando?" />
			<table style="margin-top: 10px" class="table">
				<thead>
					<tr>
						<th></th>
						<th><a href="" ng-click="ordenarPor('nome')">Nome</a></th>
						<th><a href="" ng-click="ordenarPor('fone')">Fone</a></th>
						<th>Operadora</th>
						<th>Data</th>
						<th>Status</th>
					</tr>
				</thead>
				<tbody>
					<tr ng-class="{selecionado: contato.selecionado}" ng-repeat="contato in contatos | filter: busca | orderBy: order : direcao">
						<td><input type="checkbox" ng-model="contato.selecionado"></td>
						<td>{{ contato.nome }}</td>
						<td>{{ contato.fone }}</td>
						<td>{{ contato.operadora.nome }}</td>
						<td>{{ contato.dtCadastro | date: 'dd/MM/yyyy'}}</td>
						<td ><div style="width: 15px; height: 15px; float: center" ng-style="{'background-color': contato.cor}"></div></td>
					</tr>
				</tbody>
			</table>
			<form name="contatoForm">
				<input class="form-control" type="text" ng-model="contato.nome" ng-required="true" placeholder="Nome" name="nome" ng-minlength="10">
				<input class="form-control" type="text" ng-pattern="/^\d{4,5}-\d{4}$/" ng-model="contato.fone" ng-required="true" placeholder="Fone" name="telefone">
				<select class="form-control" ng-model="contato.operadora" name="operadora" ng-required="true" ng-options="operadora.nome + '(' + (operadora.preco | currency) + ')'  group by operadora.categoria for operadora in operadoras | orderBy: 'nome'">
					<option value="">Selecione uma Operadora</option>
				</select>
			</form>
			<div ng-show="contatoForm.nome.$error.minlength && contatoForm.nome.$dirty" class="alert alert-danger">
				O campo nome deve ter no mínimo 10 caracteres!
			</div>
			<div ng-show="contatoForm.nome.$error.required && contatoForm.nome.$dirty" class="alert alert-danger">
				Por favor, preencha o nome!
			</div>
			<div ng-show="contatoForm.telefone.$error.required && contatoForm.telefone.$dirty" class="alert alert-danger">
				Por favor, preencha o telefone!
			</div>
			<div ng-show="contatoForm.telefone.$error.pattern" class="alert alert-danger">
				Erro padrao telefone!
			</div>
			<div ng-show="contatoForm.operadora.$error.required && contatoForm.operadora.$dirty" class="alert alert-danger">
				Por favor, preencha a operadora!
			</div>
			<button class="btn btn-primary btn-block" ng-click="adicionarContato(contato)" ng-disabled="contatoForm.$invalid">Adicionar</button>
			<button class="btn btn-danger btn-block" ng-click="apagarContatos(contatos)" ng-disabled="!isContatoSelecionado(contatos)">Remover</button>
		</div>
		<div ng-include="'footer.html'"></div>
	</body>
</html>